<Window x:Class="GeneratorSQL.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:GeneratorSQL.Helpers.Converters"
        xmlns:services="clr-namespace:GeneratorSQL.Services"
        Title="{Binding Strings[WindowTitle]}" Height="650" Width="950"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource Brush.Background}">
    <WindowChrome.WindowChrome>
        <WindowChrome ResizeBorderThickness="5" 
                      CaptionHeight="32" 
                      CornerRadius="10" 
                      GlassFrameThickness="0" 
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <TextBlock Text="{Binding Strings[WindowTitle]}" 
                   Grid.Row="0" 
                   VerticalAlignment="Center" 
                   Margin="15,0,0,0" 
                   Foreground="{DynamicResource Brush.TextPrimary}" 
                   FontWeight="SemiBold"/>

        <!-- Window Controls -->
        <StackPanel Grid.Row="0" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    WindowChrome.IsHitTestVisibleInChrome="True">
            
            <!-- Minimize -->
            <Button Click="MinimizeWindow"
                    Width="46" 
                    Height="32" 
                    Background="Transparent"
                    BorderThickness="0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}">
                                        <Path Data="M0,0 L10,0" 
                                              Stroke="{DynamicResource Brush.TextPrimary}" 
                                              StrokeThickness="1"
                                              Stretch="None"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Brush.SurfaceElevated}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- Maximize/Restore -->
            <Button Click="MaximizeWindow"
                    Width="46" 
                    Height="32" 
                    Background="Transparent"
                    BorderThickness="0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}">
                                        <Grid>
                                            <Path x:Name="MaximizeIcon"
                                                  Data="M1,1 L9,1 L9,9 L1,9 Z" 
                                                  Stroke="{DynamicResource Brush.TextPrimary}" 
                                                  StrokeThickness="1"
                                                  Width="10"
                                                  Height="10"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1AFFFFFF"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- Close -->
            <Button Click="CloseWindow"
                    Width="46" 
                    Height="32" 
                    Background="Transparent"
                    BorderThickness="0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}">
                                        <Path Data="M1,1 L9,9 M9,1 L1,9" 
                                              Stroke="{DynamicResource Brush.TextPrimary}" 
                                              StrokeThickness="1"
                                              Width="10"
                                              Height="10"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E81123"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>



        <!-- Main Content Area (Split View) -->
        <Grid Grid.Row="1" Margin="15,0,15,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT COLUMN: Config + Output -->
            <Grid Grid.Column="0" Margin="0,0,15,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Configuration Panel -->
                <Border Grid.Row="0" 
                        Background="{DynamicResource Brush.Surface}" 
                        CornerRadius="{StaticResource Radius.Large}" 
                        Padding="15" 
                        Margin="0,0,0,15"
                        Effect="{StaticResource Effect.Shadow.Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Table Name -->
                        <TextBlock Text="{Binding Strings[TableName]}" 
                                   Grid.Row="0" 
                                   Grid.Column="0" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,10,10"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   FontWeight="SemiBold"/>
                        <TextBox Text="{Binding TableName, UpdateSourceTrigger=PropertyChanged}" 
                                 Grid.Row="0" 
                                 Grid.Column="1" 
                                 Height="30"
                                 Padding="5,0"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,10,10"/>

                        <!-- SQL Dialect -->
                        <TextBlock Text="{Binding Strings[SqlDialect]}" 
                                   Grid.Row="0" 
                                   Grid.Column="2" 
                                   VerticalAlignment="Center" 
                                   Margin="15,0,10,10"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   FontWeight="SemiBold"/>
                        <ComboBox ItemsSource="{Binding SqlDialects}" 
                                  SelectedItem="{Binding SelectedDialect}"
                                  Grid.Row="0" 
                                  Grid.Column="3" 
                                  Width="170"
                                  Height="30"
                                  Padding="5,0"
                                  VerticalContentAlignment="Center"
                                  HorizontalAlignment="Left"
                                  Margin="0,0,0,10"
                                  Background="{DynamicResource Brush.SurfaceElevated}"
                                  Foreground="{DynamicResource Brush.TextPrimary}"
                                  BorderBrush="{DynamicResource Brush.Border}"
                                  BorderThickness="1"/>

                        <!-- Columns -->
                        <TextBlock Text="{Binding Strings[Columns]}" 
                                   Grid.Row="1" 
                                   Grid.Column="0" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,10,10"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   FontWeight="SemiBold"/>
                        <TextBox Text="{Binding Columns, Mode=OneWay}" 
                                 Grid.Row="1" 
                                 Grid.Column="1" 
                                 Grid.ColumnSpan="3" 
                                 Margin="0,0,0,10"
                                 Height="30"
                                 Padding="5,0"
                                 VerticalContentAlignment="Center"
                                 IsReadOnly="True"
                                 Background="{DynamicResource Brush.SurfaceElevated}"
                                 ToolTip="{Binding Strings[ColumnsTooltip]}"/>

                        <!-- Row Count -->
                        <TextBlock Text="{Binding Strings[RowCount]}" 
                                   Grid.Row="2" 
                                   Grid.Column="0" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,10,0"
                                   Foreground="{DynamicResource Brush.TextPrimary}"
                                   FontWeight="SemiBold"/>
                        <TextBox Text="{Binding RowCount, UpdateSourceTrigger=PropertyChanged}" 
                                 Grid.Row="2" 
                                 Grid.Column="1" 
                                 Width="100"
                                 HorizontalAlignment="Left"
                                 Height="30"
                                 Padding="5,0"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,0,0"/>

                        <!-- Options -->
                        <StackPanel Orientation="Horizontal" 
                                    Grid.Row="2" 
                                    Grid.Column="2" 
                                    Grid.ColumnSpan="2" 
                                    Margin="15,0,0,0"
                                    VerticalAlignment="Center">
                            <CheckBox Content="{Binding Strings[UseDoubleQuotes]}" 
                                      IsChecked="{Binding UseDoubleQuotes}" 
                                      Margin="0,0,20,0" 
                                      VerticalAlignment="Center"
                                      Foreground="{DynamicResource Brush.TextPrimary}"/>
                            <CheckBox Content="{Binding Strings[IncludeCommas]}" 
                                      IsChecked="{Binding IncludeCommas}" 
                                      VerticalAlignment="Center"
                                      Foreground="{DynamicResource Brush.TextPrimary}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Action Buttons -->
                <!-- Action Buttons -->
                <Grid Grid.Row="1" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Content="{Binding Strings[GenerateButton]}" 
                            Command="{Binding GenerateCommand}"
                            Background="{DynamicResource Brush.Accent}"
                            Foreground="White"
                            Width="120"
                            Height="30"
                            Padding="5,0"
                            FontSize="12"
                            Margin="0,0,10,0"/>
                    
                    <Button Grid.Column="1"
                            Content="{Binding Strings[CopyButton]}" 
                            Command="{Binding CopyToClipboardCommand}"
                            Background="{DynamicResource Brush.Success}"
                            Foreground="White"
                            Width="120"
                            Height="30"
                            Padding="5,0"
                            FontSize="12"
                            Margin="0,0,10,0"/>

                    <Button Grid.Column="2"
                            Content="{Binding Strings[ClearButton]}" 
                            Command="{Binding ClearCommand}"
                            Background="{DynamicResource Brush.Error}"
                            Foreground="White"
                            Width="120"
                            Height="30"
                            Padding="5,0"
                            FontSize="12"
                            Margin="0,0,10,0"/>

                    <ProgressBar Grid.Column="3"
                                 IsIndeterminate="True" 
                                 Visibility="{Binding IsGenerating, Converter={StaticResource BoolToVisibilityConverter}}"
                                 Height="30" 
                                 VerticalAlignment="Center"
                                 Margin="10,0,0,0"/>
                </Grid>

                <!-- Output Area (Expanded) -->
                <Border Grid.Row="2"
                        Background="{DynamicResource Brush.Surface}"
                        CornerRadius="{StaticResource Radius.Large}"
                        Padding="5"
                        Effect="{StaticResource Effect.Shadow.Card}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                  HorizontalScrollBarVisibility="Auto">
                        <TextBox Text="{Binding GeneratedOutput, Mode=TwoWay}" 
                                 IsReadOnly="True" 
                                 TextWrapping="NoWrap"
                                 FontFamily="Consolas" 
                                 FontSize="13"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Foreground="{DynamicResource Brush.TextPrimary}"
                                 Padding="10"/>
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- RIGHT COLUMN: Field Selection -->
            <Border Grid.Column="1" 
                    Background="{DynamicResource Brush.Surface}" 
                    CornerRadius="{StaticResource Radius.Large}" 
                    Padding="15" 
                    Effect="{StaticResource Effect.Shadow.Card}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="{Binding Strings[SelectFields]}" 
                               Grid.Row="0"
                               FontSize="16" 
                               FontWeight="Bold"
                               Margin="0,0,0,15"
                               Foreground="{DynamicResource Brush.TextPrimary}"/>
                    
                    <TextBox Grid.Row="1"
                             Margin="0,0,0,10"
                             Padding="10,8"
                             Text="{Binding FieldSearchText, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="{Binding Strings[SearchFieldsTooltip]}" />
                             
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="0,0,5,0">
                        <ItemsControl ItemsSource="{Binding FieldsView}">
                            <ItemsControl.Resources>
                                <converters:CategoryHeaderConverter x:Key="CategoryHeaderConverter"/>
                            </ItemsControl.Resources>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.GroupStyle>
                                <GroupStyle>
                                    <GroupStyle.HeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock FontWeight="Bold" 
                                                       FontSize="13"
                                                       Margin="0,15,0,5"
                                                       Foreground="{DynamicResource Brush.Accent}">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource CategoryHeaderConverter}">
                                                        <Binding Path="Name"/>
                                                        <Binding Path="CurrentCultureCode" Source="{x:Static services:LocalizationManager.Instance}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GroupStyle.HeaderTemplate>
                                </GroupStyle>
                            </ItemsControl.GroupStyle>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{DynamicResource Brush.SurfaceElevated}" 
                                            CornerRadius="6" 
                                            Padding="10,8" 
                                            Margin="0,2"
                                            BorderBrush="{DynamicResource Brush.Border}" 
                                            BorderThickness="1">
                                        <CheckBox Content="{Binding DisplayName}" 
                                                  IsChecked="{Binding IsSelected}"
                                                  Foreground="{DynamicResource Brush.TextPrimary}"
                                                  FontSize="13"
                                                  ToolTip="{Binding Type}"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="{DynamicResource Brush.Surface}" 
                Padding="15,8" 
                Margin="15,15,15,15" 
                CornerRadius="{StaticResource Radius.Medium}"
                Effect="{StaticResource Effect.Shadow.Card}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding StatusMessage}" Grid.Column="0" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{DynamicResource Brush.TextPrimary}"/>
                <TextBlock Grid.Column="1" VerticalAlignment="Center" Margin="12,0" Foreground="{DynamicResource Brush.TextPrimary}">
                    <Run Text="Time: "/>
                    <Run Text="{Binding LastGenerationTimeMs}"/>
                    <Run Text="ms"/>
                </TextBlock>
                <StackPanel Orientation="Horizontal" Grid.Column="2" VerticalAlignment="Center">
                    <CheckBox Content="Dark theme" IsChecked="{Binding IsDarkTheme}" VerticalAlignment="Center" Margin="0,0,15,0"/>
                    
                    <!-- Language Switcher (Moved) -->
                    <Border Background="{DynamicResource Brush.SurfaceElevated}" 
                            CornerRadius="16" 
                            Padding="2" 
                            BorderBrush="{DynamicResource Brush.Border}" 
                            BorderThickness="1">
                        <StackPanel Orientation="Horizontal">
                            <!-- EN Button -->
                            <Border x:Name="EnButton" 
                                    Background="Transparent"
                                    CornerRadius="14" 
                                    Padding="10,6" 
                                    Cursor="Hand" 
                                    MouseDown="OnLanguageClick" 
                                    Tag="en">
                                <TextBlock x:Name="EnText" 
                                           Text="ðŸ‡¬ðŸ‡§ EN" 
                                           FontSize="11"
                                           Foreground="{DynamicResource Brush.TextSecondary}"
                                           FontWeight="SemiBold"/>
                            </Border>
                            <!-- UA Button -->
                            <Border x:Name="UaButton" 
                                    Background="Transparent"
                                    CornerRadius="14" 
                                    Padding="10,6" 
                                    Cursor="Hand" 
                                    MouseDown="OnLanguageClick" 
                                    Tag="uk">
                                <TextBlock x:Name="UaText" 
                                           Text="ðŸ‡ºðŸ‡¦ UA" 
                                           FontSize="11"
                                           Foreground="{DynamicResource Brush.TextSecondary}"
                                           FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
